-- =====================================================================
-- Carga de documentación de indicadores DAX (modelo: Indicadores Ventas)
-- Nota: Los nombres y expresiones DAX están copiados tal cual del TMDL.
-- =====================================================================
CREATE OR REPLACE TABLE MIRRORING.INDICADORES_DAX_DOC (
  INDICADOR   STRING      NOT NULL,  -- Nombre exacto del indicador/medida
  DAX         STRING      NOT NULL,  -- Expresión DAX tal cual del TMDL
  DESCRIPCION STRING               -- Descripción breve de uso
);

-- ===========================
-- Bloque: Base (Moneda Local)
-- ===========================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Venta Precio Lista $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOLISTA_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio lista en moneda local, filtrado a VENTAS.'),
('Venta Precio Teórico $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOTEORICO_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio teórico ML; referencia para análisis de pricing.'),
('Venta Precio Factura $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOFACTURA_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio factura ML; monto facturado.'),
('Venta Precio Neto $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIONETO_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio neto ML; después de ajustes.'),
('Venta Real $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso real ML; base de KPIs.'),
('Venta Real Ton',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_TON]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Volumen vendido en toneladas.'),
('Venta Real UM Venta',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_UMV]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Unidades vendidas (UM Venta).'),
('Presupuesto $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PCP_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTASPCP")',
 'Agregada (SUM). Meta de ingresos ML (presupuesto).'),
('Presupuesto Ton',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PCP_TON]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTASPCP")',
 'Agregada (SUM). Meta de volumen (toneladas).'),
('Venta Precio Constructora $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOCONSTRUCTORA_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio para constructora (ML).'),
('Venta Real c/Fletes $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_FLETES_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso ML incluyendo fletes.'),
('Venta Real c/Impuestos $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_IMPUESTO_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso ML con impuestos.'),
('Venta Real c/Fletes c/Impuestos $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_FLETES_IMPUESTOS_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso ML con fletes e impuestos.'),
('Importe Descuentos $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_DESCUENTOS_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Descuentos aplicados ML.'),
('Importe Promociones $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PROMOCIONES_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Promociones ML.'),
('Importe Correctivas $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_CORRECTIVAS_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Notas correctivas ML.'),
('Importe Rebates $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REBATES_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Rebates ML.'),
('Reembolso Fletes $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_FLETES_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Reembolso de fletes ML.'),
('Importe Impuestos $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_IMPUESTOS_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Impuestos ML.'),
('Peso Bruto',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_PESO_BRUTO]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Peso bruto de ventas.'),
('Peso Neto',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_PESO_NETO]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Peso neto de ventas.'),
('Venta Precio Factura c/Impuestos $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOFACTURA_IMPUESTO_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio factura con impuestos ML.'),
('Importe Descuento Financiero Pronto Pago $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_DESCUENTOFIN_PRONTOPAGO_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Descuento financiero por pronto pago.'),
('Costos Internos $ML',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_COSTOSINTERNOS_LOC]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Costos internos ML.'),
('Precio Promedio Lista $ML',
 'DIVIDE([Venta Precio Lista $ML],[Venta Real Ton],0)',
 'Calculada (ratio). Precio lista promedio por tonelada (ML).'),
('Precio Promedio Teórico $ML',
 'DIVIDE([Venta Precio Teórico $ML],[Venta Real Ton],0)',
 'Calculada (ratio). Precio teórico promedio por tonelada.'),
('Precio Promedio Factura $ML',
 'DIVIDE([Venta Precio Factura $ML],[Venta Real Ton],0)',
 'Calculada (ratio). Precio factura promedio por tonelada.'),
('Precio Promedio Neto $ML',
 'DIVIDE([Venta Precio Neto $ML],[Venta Real Ton],0)',
 'Calculada (ratio). Precio neto promedio por tonelada.'),
('Precio Promedio Real $ML',
 'DIVIDE([Venta Real $ML],[Venta Real Ton],0)',
 'Calculada (ratio). Precio promedio realmente cobrado por tonelada.'),
('Precio Promedio Presupuesto $ML',
 'DIVIDE([Presupuesto $ML],[Presupuesto Ton],0)',
 'Calculada (ratio). Precio planificado por tonelada.'),
('Precio Promedio (UM Venta) $ML',
 'DIVIDE([Venta Real $ML],[Venta Real UM Venta],0)',
 'Calculada (ratio). Precio promedio por unidad (UM Venta).'),
('Δ Var Venta Real vs Presupuesto $ML',
 '[Venta Real $ML] - [Presupuesto $ML]',
 'Calculada (dif. absoluta). Brecha de ingresos vs presupuesto.'),
('Δ Var Precio Promedio vs Presupuesto $ML',
 '[Precio Promedio Real $ML] - [Precio Promedio Presupuesto $ML]',
 'Calculada (dif. absoluta). Gap de pricing promedio vs plan.'),
('Δ Var Tonelada vs Presupuesto',
 '[Venta Real Ton] - [Presupuesto Ton]',
 'Calculada (dif. absoluta). Brecha de volumen vs plan.'),
('Δ Var Venta Real vs Presupuesto %',
 'DIVIDE([Δ Var Venta Real vs Presupuesto $ML],[Presupuesto $ML],0)',
 'Calculada (%). % diferencia de ingresos vs plan.'),
('Δ Var Precio Promedio vs Presupuesto %',
 'DIVIDE([Δ Var Precio Promedio vs Presupuesto $ML],[Precio Promedio Presupuesto $ML],0)',
 'Calculada (%). % diferencia de precio promedio vs plan.'),
('Δ Var Tonelada vs Presupuesto %',
 'DIVIDE([Δ Var Tonelada vs Presupuesto],[Presupuesto Ton],0)',
 'Calculada (%). % diferencia de volumen vs plan.');

-- =============================
-- Bloque: Tiempo (Moneda Local)
-- =============================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Venta Real $ML (MTD)',
 'TOTALMTD([Venta Real $ML], ''DimCal - Calendario''[Fecha])',
 'Agregada (MTD). Ingreso acumulado del mes.'),
('Venta Real $ML (PMTD)',
 'TOTALMTD([Venta Real $ML],PARALLELPERIOD(''DimCal - Calendario''[Fecha],-1,MONTH))',
 'Agregada (PMTD). Ingreso MTD del mes previo.'),
('Venta Real $ML (PYMTD)',
 'TOTALMTD([Venta Real $ML], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYMTD). Ingreso MTD del mismo mes del año anterior.'),
('Venta Real $ML (YTD)',
 'TOTALYTD([Venta Real $ML],  ''DimCal - Calendario''[Fecha])',
 'Agregada (YTD). Ingreso acumulado del año.'),
('Venta Real $ML (PYTD)',
 'TOTALYTD([Venta Real $ML], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYTD). Ingreso acumulado del año anterior.'),
('Venta Real $ML (PY)',
 'TOTALYTD([Venta Real $ML], SAMEPERIODLASTYEAR(ENDOFYEAR(''DimCal - Calendario''[Fecha])))',
 'Agregada (PY). Ingreso del año anterior (corte fin de año).'),
('Venta Real $ML (CY)',
 'TOTALYTD([Venta Real $ML], ENDOFYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (CY). Ingreso del año en curso (corte fin de año).'),
('Presupuesto $ML (MTD)',
 'TOTALMTD([Presupuesto $ML], ''DimCal - Calendario''[Fecha])',
 'Agregada (MTD). Presupuesto acumulado del mes.'),
('Presupuesto $ML (PMTD)',
 'TOTALMTD([Presupuesto $ML], PARALLELPERIOD(''DimCal - Calendario''[Fecha],-1,MONTH))',
 'Agregada (PMTD). Presupuesto MTD del mes previo.'),
('Presupuesto $ML (PYMTD)',
 'TOTALMTD([Presupuesto $ML], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYMTD). Presupuesto MTD mismo mes AA.'),
('Presupuesto $ML (YTD)',
 'TOTALYTD([Presupuesto $ML],''DimCal - Calendario''[Fecha])',
 'Agregada (YTD). Presupuesto acumulado del año.'),
('Presupuesto $ML (PYTD)',
 'TOTALYTD([Presupuesto $ML], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYTD). Presupuesto acumulado año anterior.'),
('Presupuesto $ML (CY)',
 'TOTALYTD([Presupuesto $ML], ENDOFYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (CY). Presupuesto del año en curso (corte fin de año).'),
('Presupuesto $ML (PY)',
 'TOTALYTD([Presupuesto $ML], SAMEPERIODLASTYEAR(ENDOFYEAR(''DimCal - Calendario''[Fecha])))',
 'Agregada (PY). Presupuesto año anterior (corte fin de año).'),
('Precio Promedio Real $ML (MTD)',
 'DIVIDE([Venta Real $ML (MTD)],[Venta Real Ton (MTD)],0)',
 'Calculada (ratio). Precio promedio MTD.'),
('Precio Promedio Real $ML (PMTD)',
 'DIVIDE([Venta Real $ML (PMTD)], [Venta Real Ton (PMTD)],0)',
 'Calculada (ratio). Precio promedio PMTD.'),
('Precio Promedio Real $ML (PYMTD)',
 'DIVIDE([Venta Real $ML (PYMTD)], [Venta Real Ton (PYMTD)],0)',
 'Calculada (ratio). Precio promedio MTD del año anterior.'),
('Precio Promedio Real $ML (YTD)',
 'DIVIDE([Venta Real $ML (YTD)], [Venta Real Ton (YTD)],0)',
 'Calculada (ratio). Precio promedio YTD.'),
('Precio Promedio Real $ML (PYTD)',
 'DIVIDE([Venta Real $ML (PYTD)], [Venta Real Ton (PYTD)],0)',
 'Calculada (ratio). Precio promedio PYTD.'),
('Precio Promedio Real $ML (CY)',
 'DIVIDE([Venta Real $ML (CY)], [Venta Real Ton (CY)],0)',
 'Calculada (ratio). Precio promedio año en curso.'),
('Precio Promedio Real $ML (PY)',
 'DIVIDE([Venta Real $ML (PY)], [Venta Real Ton (PY)],0)',
 'Calculada (ratio). Precio promedio año anterior.'),
('Precio Promedio Presupuesto $ML (MTD)',
 'DIVIDE([Presupuesto $ML (MTD)], [Presupuesto Ton (MTD)],0)',
 'Calculada (ratio). Precio planificado MTD.'),
('Precio Promedio Presupuesto $ML (PMTD)',
 'DIVIDE([Presupuesto $ML (PMTD)], [Presupuesto Ton (PMTD)],0)',
 'Calculada (ratio). Precio planificado PMTD.'),
('Precio Promedio Presupuesto $ML (PYMTD)',
 'DIVIDE([Presupuesto $ML (PYMTD)], [Presupuesto Ton (PYMTD)],0)',
 'Calculada (ratio). Precio planificado MTD del año anterior.'),
('Precio Promedio Presupuesto $ML (YTD)',
 'DIVIDE([Presupuesto $ML (YTD)], [Presupuesto Ton (YTD)],0)',
 'Calculada (ratio). Precio planificado YTD.'),
('Precio Promedio Presupuesto $ML (PYTD)',
 'DIVIDE([Presupuesto $ML (PYTD)], [Presupuesto Ton (PYTD)],0)',
 'Calculada (ratio). Precio planificado PYTD.'),
('Precio Promedio Presupuesto $ML (CY)',
 'DIVIDE([Presupuesto $ML (CY)], [Presupuesto Ton (CY)],0)',
 'Calculada (ratio). Precio planificado año en curso.'),
('Precio Promedio Presupuesto $ML (PY)',
 'DIVIDE([Presupuesto $ML (PY)], [Presupuesto Ton (PY)],0)',
 'Calculada (ratio). Precio planificado año anterior.'),
('Δ Var Venta Real $ML (PMTD)',
 '[Venta Real $ML (MTD)] - [Venta Real $ML (PMTD)]',
 'Calculada (dif. absoluta). Cambio MTD vs PMTD en ingresos.'),
('Δ Var Precio Promedio $ML (PMTD)',
 '[Precio Promedio Real $ML (MTD)]- [Precio Promedio Real $ML (PMTD)]',
 'Calculada (dif. absoluta). Cambio de precio promedio MTD vs PMTD.'),
('Δ Var Venta Real % (PMTD)',
 'DIVIDE([Δ Var Venta Real $ML (PMTD)], [Venta Real $ML (PMTD)],0)',
 'Calculada (%). Variación MTD vs PMTD de ingresos.'),
('Δ Var Precio Promedio % (PMTD)',
 'DIVIDE([Δ Var Precio Promedio $ML (PMTD)], [Precio Promedio Real $ML (PMTD)],0)',
 'Calculada (%). Variación MTD vs PMTD de precio promedio.'),
('Δ Var Venta Real $ML (PYMTD)',
 '[Venta Real $ML (MTD)]-[Venta Real $ML (PYMTD)]',
 'Calculada (dif. absoluta). Cambio MTD vs mismo mes AA.'),
('Δ Var Precio Promedio $ML (PYMTD)',
 '[Precio Promedio Real $ML (MTD)] - [Precio Promedio Real $ML (PYMTD)]',
 'Calculada (dif. absoluta). Cambio de precio MTD vs AA.'),
('Δ Var Venta Real % (PYMTD)',
 'DIVIDE([Δ Var Venta Real $ML (PYMTD)], [Venta Real $ML (PYMTD)],0)',
 'Calculada (%). Variación MTD vs AA de ingresos.'),
('Δ Var Precio Promedio % (PYMTD)',
 'DIVIDE([Δ Var Precio Promedio $ML (PYMTD)], [Precio Promedio Real $ML (PYMTD)],0)',
 'Calculada (%). Variación MTD vs AA de precio promedio.'),
('Δ Var Venta Real $ML (YTD)',
 '[Venta Real $ML (YTD)]-[Venta Real $ML (PYTD)]',
 'Calculada (dif. absoluta). Cambio YTD vs PYTD en ingresos.'),
('Δ Var Precio Promedio $ML (YTD)',
 '[Precio Promedio Real $ML (YTD)]-[Precio Promedio Real $ML (PYTD)]',
 'Calculada (dif. absoluta). Cambio YTD vs PYTD de precio promedio.'),
('Δ Var Venta Real % (YTD)',
 'DIVIDE([Δ Var Venta Real $ML (YTD)], [Venta Real $ML (PYTD)],0)',
 'Calculada (%). Variación YTD vs PYTD de ingresos.'),
('Δ Var Precio Promedio % (YTD)',
 'DIVIDE([Δ Var Precio Promedio $ML (YTD)], [Precio Promedio Real $ML (PYTD)],0)',
 'Calculada (%). Variación YTD vs PYTD de precio promedio.'),
('Δ Var Venta Real vs Presupuesto $ML (MTD)',
 '[Venta Real $ML (MTD)]- [Presupuesto $ML (MTD)]',
 'Calculada (dif. absoluta). Gap MTD vs presupuesto.'),
('Δ Var Precio Promedio vs Presupuesto $ML (MTD)',
 '[Precio Promedio Real $ML (MTD)]-[Precio Promedio Presupuesto $ML (MTD)]',
 'Calculada (dif. absoluta). Gap precio MTD vs plan.'),
('Δ Var Venta Real vs Presupuesto % (MTD)',
 'DIVIDE([Δ Var Venta Real vs Presupuesto $ML (MTD)], [Presupuesto $ML (MTD)],0)',
 'Calculada (%). % diferencia MTD vs plan.'),
('Δ Var Precio Promedio vs Presupuesto % (MTD)',
 'DIVIDE( [Δ Var Precio Promedio vs Presupuesto $ML (MTD)], [Precio Promedio Presupuesto $ML (MTD)],0)',
 'Calculada (%). % diferencia del precio promedio MTD vs plan.'),
('Δ Var Venta Real vs Presupuesto $ML (YTD)',
 '[Venta Real $ML (YTD)]-[Presupuesto $ML (YTD)]',
 'Calculada (dif. absoluta). Gap YTD vs plan.'),
('Δ Var Precio Promedio vs Presupuesto $ML (YTD)',
 '[Precio Promedio Real $ML (YTD)]-[Precio Promedio Presupuesto $ML (YTD)]',
 'Calculada (dif. absoluta). Gap de precio YTD vs plan.'),
('Δ Var Venta Real vs Presupuesto % (YTD)',
 'DIVIDE( [Δ Var Venta Real vs Presupuesto $ML (YTD)], [Presupuesto $ML (YTD)],0)',
 'Calculada (%). % diferencia YTD vs plan.'),
('Δ Var Precio Promedio vs Presupuesto % (YTD)',
 'DIVIDE([Δ Var Precio Promedio vs Presupuesto $ML (YTD)], [Precio Promedio Presupuesto $ML (YTD)],0)',
 'Calculada (%). % diferencia del precio promedio YTD vs plan.');

-- =============================
-- Bloque: Tiempo (Volumen/UMV)
-- =============================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Venta Real Ton (MTD)',
 'CALCULATE([Venta Real Ton], KEEPFILTERS(DATESMTD(''DimCal - Calendario''[Fecha])))',
 'Agregada (MTD). Volumen acumulado del mes.'),
('Venta Real Ton (PMTD)',
 'TOTALMTD([Venta Real Ton],PARALLELPERIOD(''DimCal - Calendario''[Fecha],-1,MONTH))',
 'Agregada (PMTD). Volumen MTD del mes previo.'),
('Venta Real Ton (PYMTD)',
 'TOTALMTD([Venta Real Ton], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYMTD). Volumen MTD del mismo mes AA.'),
('Venta Real Ton (YTD)',
 'TOTALYTD([Venta Real Ton],''DimCal - Calendario''[Fecha])',
 'Agregada (YTD). Volumen acumulado del año.'),
('Venta Real Ton (PYTD)',
 'TOTALYTD([Venta Real Ton], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYTD). Volumen acumulado año anterior.'),
('Venta Real Ton (CY)',
 'TOTALYTD([Venta Real Ton], ENDOFYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (CY). Volumen año en curso (corte fin de año).'),
('Venta Real Ton (PY)',
 'TOTALYTD([Venta Real Ton],SAMEPERIODLASTYEAR(ENDOFYEAR(''DimCal - Calendario''[Fecha])))',
 'Agregada (PY). Volumen año anterior (corte fin de año).'),
('Venta Real UM Venta (MTD)',
 'TOTALMTD([Venta Real UM Venta], ''DimCal - Calendario''[Fecha])',
 'Agregada (MTD). Unidades vendidas MTD.'),
('Venta Real UM Venta (PMTD)',
 'TOTALMTD([Venta Real UM Venta],PARALLELPERIOD(''DimCal - Calendario''[Fecha],-1,MONTH))',
 'Agregada (PMTD). Unidades vendidas PMTD.'),
('Venta Real UM Venta (PYMTD)',
 'TOTALMTD([Venta Real UM Venta], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYMTD). Unidades MTD mismo mes AA.'),
('Venta Real UM Venta (YTD)',
 'TOTALYTD([Venta Real UM Venta],  ''DimCal - Calendario''[Fecha])',
 'Agregada (YTD). Unidades vendidas YTD.'),
('Venta Real UM Venta (PYTD)',
 'TOTALYTD([Venta Real UM Venta], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYTD). Unidades YTD año anterior.'),
('Venta Real UM Venta (CY)',
 'TOTALYTD([Venta Real UM Venta], ENDOFYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (CY). Unidades año en curso (corte fin de año).'),
('Venta Real UM Venta (PY)',
 'TOTALYTD([Venta Real UM Venta], SAMEPERIODLASTYEAR(ENDOFYEAR(''DimCal - Calendario''[Fecha])))',
 'Agregada (PY). Unidades año anterior (corte fin de año).'),
('Δ Var Tonelada (PMTD)',
 '[Venta Real Ton (MTD)]-[Venta Real Ton (PMTD)]',
 'Calculada (dif. absoluta). Cambio MTD vs PMTD de volumen.'),
('Δ Var Tonelada % (PMTD)',
 'DIVIDE([Δ Var Tonelada (PMTD)], [Venta Real Ton (PMTD)],0)',
 'Calculada (%). % cambio MTD vs PMTD de volumen.'),
('Δ Var Tonelada (PYMTD)',
 '[Venta Real Ton (MTD)] -  [Venta Real Ton (PYMTD)]',
 'Calculada (dif. absoluta). Cambio MTD vs AA de volumen.'),
('Δ Var Tonelada % (PYMTD)',
 'DIVIDE([Δ Var Tonelada (PYMTD)], [Venta Real Ton (PYMTD)],0)',
 'Calculada (%). % cambio MTD vs AA de volumen.'),
('Δ Var Tonelada (YTD)',
 '[Venta Real Ton (YTD)]- [Venta Real Ton (PYTD)]',
 'Calculada (dif. absoluta). Cambio YTD vs PYTD de volumen.'),
('Δ Var Tonelada % (YTD)',
 'DIVIDE([Δ Var Tonelada (YTD)], [Venta Real Ton (PYTD)],0)',
 'Calculada (%). % cambio YTD vs PYTD de volumen.'),
('Presupuesto Ton (MTD)',
 'TOTALMTD([Presupuesto Ton], ''DimCal - Calendario''[Fecha])',
 'Agregada (MTD). Presupuesto de volumen MTD.'),
('Presupuesto Ton (PMTD)',
 'TOTALMTD([Presupuesto Ton], PARALLELPERIOD(''DimCal - Calendario''[Fecha],-1,MONTH))',
 'Agregada (PMTD). Presupuesto de volumen PMTD.'),
('Presupuesto Ton (PYMTD)',
 'TOTALMTD([Presupuesto Ton], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYMTD). Presupuesto volumen MTD año anterior.'),
('Presupuesto Ton (YTD)',
 'TOTALYTD([Presupuesto Ton], ''DimCal - Calendario''[Fecha])',
 'Agregada (YTD). Presupuesto volumen acumulado del año.'),
('Presupuesto Ton (PYTD)',
 'TOTALYTD([Presupuesto Ton], SAMEPERIODLASTYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (PYTD). Presupuesto volumen año anterior.'),
('Presupuesto Ton (CY)',
 'TOTALYTD([Presupuesto Ton], ENDOFYEAR(''DimCal - Calendario''[Fecha]))',
 'Agregada (CY). Presupuesto volumen año en curso (corte fin de año).'),
('Presupuesto Ton (PY)',
 'TOTALYTD([Presupuesto Ton], PREVIOUSYEAR(ENDOFYEAR(''DimCal - Calendario''[Fecha])))',
 'Agregada (PY). Presupuesto volumen año anterior (corte fin de año).');

-- =================
-- Bloque: Variances
-- =================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Δ Var Venta Real vs Presupuesto $ML (YTD)',
 '[Venta Real $ML (YTD)]-[Presupuesto $ML (YTD)]',
 'Calculada (dif. absoluta). Gap YTD de ingresos vs plan.'),
('Δ Var Precio Promedio vs Presupuesto $ML (YTD)',
 '[Precio Promedio Real $ML (YTD)]-[Precio Promedio Presupuesto $ML (YTD)]',
 'Calculada (dif. absoluta). Gap de precio promedio YTD vs plan.'),
('Δ Var Tonelada vs Presupuesto (YTD)',
 '[Venta Real Ton (YTD)]-[Presupuesto Ton (YTD)]',
 'Calculada (dif. absoluta). Gap YTD de volumen vs plan.'),
('Δ Var Venta Real vs Presupuesto % (YTD)',
 'DIVIDE( [Δ Var Venta Real vs Presupuesto $ML (YTD)], [Presupuesto $ML (YTD)],0)',
 'Calculada (%). % gap YTD vs plan.'),
('Δ Var Precio Promedio vs Presupuesto % (YTD)',
 'DIVIDE([Δ Var Precio Promedio vs Presupuesto $ML (YTD)], [Precio Promedio Presupuesto $ML (YTD)],0)',
 'Calculada (%). % gap precio promedio YTD vs plan.'),
('Δ Var Tonelada vs Presupuesto % (YTD)',
 'DIVIDE([Δ Var Tonelada vs Presupuesto (YTD)], [Presupuesto Ton (YTD)],0)',
 'Calculada (%). % gap volumen YTD vs plan.');

-- ================
-- Bloque: Divisas USD
-- ================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Venta Precio Lista $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOLISTA_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio lista en USD.'),
('Venta Precio Teórico $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOTEORICO_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio teórico USD.'),
('Venta Precio Factura $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOFACTURA_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio factura USD.'),
('Venta Precio Neto $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIONETO_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio neto USD.'),
('Venta Real $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso real USD.'),
('Presupuesto $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PCP_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTASPCP")',
 'Agregada (SUM). Presupuesto USD.'),
('Venta Precio Constructora $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOCONSTRUCTORA_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio constructora USD.'),
('Venta Real c/Fletes $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_FLETES_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso USD con fletes.'),
('Venta Real c/Impuestos $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_IMPUESTO_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso USD con impuestos.'),
('Venta Real c/Fletes c/Impuestos $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_FLETES_IMPUESTOS_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso USD con fletes e impuestos.'),
('Importe Descuentos $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_DESCUENTOS_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Descuentos USD.'),
('Importe Promociones $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PROMOCIONES_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Promociones USD.'),
('Importe Correctivas $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_CORRECTIVAS_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Notas correctivas USD.'),
('Importe Rebates $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REBATES_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Rebates USD.'),
('Reembolso Fletes $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_FLETES_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Reembolso fletes USD.'),
('Importe Impuestos $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_IMPUESTOS_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Impuestos USD.'),
('Venta Precio Factura c/Impuestos $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOFACTURA_IMPUESTO_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio factura con impuestos USD.'),
('Importe Descuento Financiero Pronto Pago $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_DESCUENTOFIN_PRONTOPAGO_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Descuento financiero pronto pago USD.'),
('Costos Internos $USD',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_COSTOSINTERNOS_USD]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Costos internos USD.');

-- ========================
-- Bloque: Divisas MXN
-- ========================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Venta Precio Lista $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOLISTA_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio lista MXN.'),
('Venta Precio Teórico $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOTEORICO_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio teórico MXN.'),
('Venta Precio Factura $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOFACTURA_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio factura MXN.'),
('Venta Precio Neto $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIONETO_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio neto MXN.'),
('Venta Real $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso real MXN.'),
('Venta Precio Constructora $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOCONSTRUCTORA_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio constructora MXN.'),
('Venta Real c/Fletes $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_FLETES_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso MXN con fletes.'),
('Venta Real c/Impuestos $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_IMPUESTO_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso MXN con impuestos.'),
('Venta Real c/Fletes c/Impuestos $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REAL_FLETES_IMPUESTOS_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Ingreso MXN con fletes e impuestos.'),
('Importe Descuentos $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_DESCUENTOS_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Descuentos MXN.'),
('Importe Promociones $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PROMOCIONES_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Promociones MXN.'),
('Importe Correctivas $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_CORRECTIVAS_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Notas correctivas MXN.'),
('Importe Rebates $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_REBATES_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Rebates MXN.'),
('Reembolso Fletes $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_FLETES_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Reembolso fletes MXN.'),
('Importe Impuestos $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_IMPUESTOS_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Impuestos MXN.'),
('Venta Precio Factura c/Impuestos $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_PRECIOFACTURA_IMPUESTO_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Precio factura con impuestos MXN.'),
('Importe Descuento Financiero Pronto Pago $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_VENTA_DESCUENTOFIN_PRONTOPAGO_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Descuento financiero pronto pago MXN.'),
('Costos Internos $MXN',
 'CALCULATE(SUM(''FctCom - Comercial Adhesivos''[VTA_IND_COSTOSINTERNOS_MXN]), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS")',
 'Agregada (SUM). Costos internos MXN.');

-- ============================
-- Bloque: Medidas adicionales
-- ============================
INSERT INTO MIRRORING.INDICADORES_DAX_DOC (INDICADOR, DAX, DESCRIPCION) VALUES
('Venta Real Ton (>13)',
 'CALCULATE([Venta Real Ton], KEEPFILTERS(FILTER(''DimCal - Calendario'', DAY(''DimCal - Calendario''[Fecha]) > 13)))',
 'Agregada (filtro Día>13). Comparativas a partir de mitad de mes.'),
('Promedio Venta Real Ton (YTD)',
 'VAR FechaMaxCtx  = MAX ( ''DimCal - Calendario''[Fecha] ) VAR CorteCtxCY   = EOMONTH ( FechaMaxCtx, 0 ) VAR CorteRefCY   = EOMONTH ( TODAY(), 0 ) VAR FechaCorteCY = MIN ( CorteCtxCY, CorteRefCY ) VAR InicioCY     = DATE ( YEAR( FechaCorteCY ), 1, 1 ) VAR VentaAcumCY  = CALCULATE ( [Venta Real Ton], DATESBETWEEN ( ''DimCal - Calendario''[Fecha], InicioCY, FechaCorteCY ) ) VAR MesesCY      = MONTH ( FechaCorteCY ) RETURN DIVIDE ( VentaAcumCY, MesesCY )',
 'Calculada (promedio). Volumen promedio mensual transcurrido del año.'),
('Promedio Venta Real Ton (PYTD)',
 'VAR FechaMaxCtx  = MAX ( ''DimCal - Calendario''[Fecha] ) VAR CorteCtxPY   = EOMONTH ( EDATE( FechaMaxCtx, -12 ), 0 ) VAR CorteRefPY   = EOMONTH ( EDATE( TODAY(), -12 ), 0 ) VAR FechaCortePY = MIN ( CorteCtxPY, CorteRefPY ) VAR InicioPY     = DATE ( YEAR( FechaCortePY ), 1, 1 ) VAR VentaAcumPY  = CALCULATE ( [Venta Real Ton], DATESBETWEEN ( ''DimCal - Calendario''[Fecha], InicioPY, FechaCortePY ) ) VAR MesesPY      = MONTH ( FechaCortePY ) RETURN DIVIDE ( VentaAcumPY, MesesPY )',
 'Calculada (promedio). Volumen promedio mensual año anterior hasta mismo corte.'),
-- ('FechaCorte',
--  'VAR HoyEOM = EOMONTH ( TODAY(), 0 ) VAR UltFechaVentas = MAXX ( FILTER ( ALL ( ''DimCal - Calendario''[Fecha] ), CALCULATE ( COUNTROWS ( ''FctCom - Comercial Adhesivos'' ), ''FctCom - Comercial Adhesivos''[Modelo Comercial] = "VENTAS" ) > 0 ), ''DimCal - Calendario''[Fecha] ) RETURN MIN ( HoyEOM, UltFechaVentas )',
--  'Helper de fecha. Fin de mes vigente limitado por última fecha con ventas.'),
-- ('Promedio Presupuesto Ton (YTD)',
 'VAR FechaMaxCtx  = MAX ( ''DimCal - Calendario''[Fecha] ) VAR FechaCorte   = MIN ( EOMONTH ( FechaMaxCtx, 0 ), EOMONTH ( TODAY(), 0 ) ) VAR InicioAnio   = DATE ( YEAR ( FechaCorte ), 1, 1 ) VAR PresAcum     = CALCULATE ( [Presupuesto Ton], DATESBETWEEN ( ''DimCal - Calendario''[Fecha], InicioAnio, FechaCorte ) ) VAR MesesTrans   = MONTH ( FechaCorte ) RETURN DIVIDE ( PresAcum, MesesTrans )',
 'Calculada (promedio). Presupuesto promedio mensual transcurrido del año.');

SELECT COUNT(*) AS TOTAL_REGISTROS FROM MIRRORING.INDICADORES_DAX_DOC;

SELECT * FROM MIRRORING.INDICADORES_DAX_DOC ORDER BY INDICADOR;

DELETE FROM MIRRORING.INDICADORES_DAX_DOC
WHERE INDICADOR = 'FechaCorte';

CREATE OR REPLACE STREAM MIRRORING.STREAM_DIM_DIM_CLI_ASESORPEDIDO ON TABLE MIRRORING.DIM_CLI_ASESORPEDIDO;

CREATE OR REPLACE STREAM MIRRORING.STREAM_INDICADORES_DAX_DOC ON TABLE MIRRORING.INDICADORES_DAX_DOC;
