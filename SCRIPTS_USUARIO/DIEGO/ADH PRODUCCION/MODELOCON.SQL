CREATE OR REPLACE PROCEDURE CON.SP_CON_FCT_LOG_ADH_ABASTECIMIENTOS_DELTA()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE


     ------------ VARIABLES DE ENTORNO ------------ 
	ID varchar(250)					:= NULL;
    D_PROCESO VARCHAR(250)	        :=''FCT_LOG_ABASTECIMIENTOS_DELTA'';
	D_TABLAAFECTADA VARCHAR(250)    := NULL;
	D_RESULTADO VARCHAR(10)         := NULL;
	D_OPERACION VARCHAR(10)		    := NULL;
	N_REGISTROS NUMBER(38,0)        := NULL;
	NM_TIPO_LOG VARCHAR(100)        := NULL;
	F_INICIO TIMESTAMP_NTZ(9)       := NULL;
	F_FIN TIMESTAMP_NTZ(9)          := NULL;
	T_EJECUCION NUMBER(38,0)   		:= NULL;
	D_MENSAJE VARCHAR(250)          := NULL;

BEGIN

    //Generacion del identificador del proceso
    SELECT UUID_STRING() INTO :ID; 
    
    BEGIN

		------------ LLENADO DE TABLAS --------------------------
        ---------------------------------------------------------
		
        // Inicia proceso INSERT
        SELECT CURRENT_TIMESTAMP() INTO :F_INICIO;

DELETE FROM CON.FCT_LOG_ADH_ABASTECIMIENTOS
WHERE DOCCOMPRAS IN (SELECT DISTINCT EBELN FROM RAW.SQ1_EXT_2LIS_02_SCL
WHERE FECHA_CARGA = (SELECT MAX(FECHA_CARGA) ------------ULTIMOS REGISTROS--------
                       FROM RAW.SQ1_EXT_2LIS_02_SCL)
        AND TIPO = ''DELTA''
);
INSERT INTO CON.FCT_LOG_ADH_ABASTECIMIENTOS(
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,

IND_CANT_EM_TOTAL,
UM_PEDIDO,

IND_IMPTE_COMPRA_PED,
IND_IMPTE_FLETE_PED,
IND_IMPTE_COMPRA_SIN_FLETE_PED,
MON_PED,

IND_IMPTE_COMPRA_LOC,
IND_IMPTE_FLETE_LOC,
IND_IMPTE_COMPRA_SIN_FLETE_LOC ,
MON_LOC,

IND_IMPTE_COMPRA_USD,
IND_IMPTE_FLETE_USD,
IND_IMPTE_COMPRA_SIN_FLETE_USD,
MON_USD,

IND_IMPTE_COMPRA_EUR,
IND_IMPTE_FLETE_EUR,
IND_IMPTE_COMPRA_SIN_FLETE_EUR,
MON_EUR,

TIPOCAMBIO_USD,
TIPOCAMBIO_EUR,

IND_CANT_DIAS_COLOCACION,
IND_CANT_POSICIONES_PEDIDO,

IND_CANT_EM_PEDIDO_ENTIEMPO, 
IND_CANT_EM_COMPLETAS_ENTIEMPO, 
IND_CANT_POS_COMPLETAS_ENTIEMPO,
IND_CANT_POS_NOCOMPLETAS_ENTIEMPO,

IND_CANT_EM_TOTAL_VENCIDAS,
IND_CANT_DIASPONDERADOS,
IND_CANT_DIASPODERADOS_ANT,
IND_CANT_POS_TOTAL,

CLAVEMP_LOC,
CLAVEMP_USD,
CLAVEMP_EUR,

SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA
)
--------------------------------------------NIVEL DE SERVICIOS--------------------------------------------------

------------------------------------------- Fecha Entrega --------------------------------------------
SELECT
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,

0 AS IND_CANT_EM_TOTAL,
UM_PEDIDO,

0 AS IND_IMPTE_COMPRA_PED,
0 AS IND_IMPTE_FLETE_PED,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_PED,
MON_PED,

0 AS IND_IMPTE_COMPRA_LOC,
0 AS IND_IMPTE_FLETE_LOC,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_LOC ,
MON_LOC,

0 AS IND_IMPTE_COMPRA_USD,
0 AS IND_IMPTE_FLETE_USD,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_USD,
MON_USD,

0 AS IND_IMPTE_COMPRA_EUR,
0 AS IND_IMPTE_FLETE_EUR,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_EUR,
MON_EUR,

0 AS TIPOCAMBIO_USD,
0 AS TIPOCAMBIO_EUR,

0 AS IND_CANT_DIAS_COLOCACION ,
0 AS IND_CANT_POSICIONES_PEDIDO,

SUM(IND_CANT_EM_PEDIDO_ENTIEMPO) AS IND_CANT_EM_PEDIDO_ENTIEMPO, 
SUM(IND_CANT_EM_COMPLETAS_ENTIEMPO) AS IND_CANT_EM_COMPLETAS_ENTIEMPO, 
CASE 
    WHEN GRUPOARTICULOS_ID IN (''000'',''001'',''102'',''104'',''107'') 
    THEN IFF((SUM(IND_CANT_EM_COMPLETAS_ENTIEMPO)*100/SUM(IND_CANT_EM_PEDIDO_ENTIEMPO))>=70,1,0) 
    ELSE IFF((SUM(IND_CANT_EM_COMPLETAS_ENTIEMPO)*100/SUM(IND_CANT_EM_PEDIDO_ENTIEMPO))>=90,1,0) 
END AS IND_CANT_POS_COMPLETAS_ENTIEMPO,
CASE 
    WHEN GRUPOARTICULOS_ID IN (''000'',''001'',''102'',''104'',''107'') 
    THEN IFF((SUM(IND_CANT_EM_COMPLETAS_ENTIEMPO)*100/SUM(IND_CANT_EM_PEDIDO_ENTIEMPO))>=70,0,1) 
    ELSE IFF((SUM(IND_CANT_EM_COMPLETAS_ENTIEMPO)*100/SUM(IND_CANT_EM_PEDIDO_ENTIEMPO))>=90,0,1) 
END AS IND_CANT_POS_NOCOMPLETAS_ENTIEMPO,

0 AS IND_CANT_EM_TOTAL_VENCIDAS,
0 AS IND_CANT_DIASPONDERADOS,
0 AS IND_CANT_DIASPODERADOS_ANT,
0 AS IND_CANT_POS_TOTAL,

CONCAT(MON_PED,''_'',MON_LOC) AS CLAVEMP_LOC,
CONCAT(MON_PED,''_USD'') AS CLAVEMP_USD,
CONCAT(MON_PED,''_EUR'') AS CLAVEMP_EUR,

SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA

FROM(

SELECT
SUBSTR(FECHA_ENTREGAPLANIFICADA, 0, 4) AS anio,
SUBSTR(FECHA_ENTREGAPLANIFICADA, 6, 2) AS mes,
CONCAT(SUBSTR(FECHA_ENTREGAPLANIFICADA, 0, 4), SUBSTR(FECHA_ENTREGAPLANIFICADA, 6, 2)) AS aniomes,
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
UM_PEDIDO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,
MON_LOC,
MON_PED,
MON_USD,
MON_EUR,
SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA,

IND_CANTIDAD_UM_PED AS IND_CANT_EM_PEDIDO_ENTIEMPO, -- 0CPQUAOU --> ZCTD_PED
0 AS IND_CANT_EM_COMPLETAS_ENTIEMPO -- 0CPDEOGQUOU --> ZCTD_ENT

FROM PRE.PFCT_LOG_ABASTECIMIENTOS
WHERE DOCCOMPRAS_CLASE IN (''LP'',''NB'',''ZDNP'',''ZFIN'',''ZINV'',''ZIPT'',''ZNB'',''ZNBS'',''ZURG'')
  AND CLAVEOPERACION IN (''001'', ''004'', ''005'', ''011'')
  AND SUBSTRING(ALMACENCENTRO_ID, 1, POSITION(''_'' IN ALMACENCENTRO_ID) - 1) IN ('''', ''ME01'', ''MP01'', ''MP02'', ''RF01'', ''RF02'')

 UNION ALL
    
SELECT
SUBSTR(FECHA_ENTREGAPLANIFICADA, 0, 4) AS anio,
SUBSTR(FECHA_ENTREGAPLANIFICADA, 6, 2) AS mes,
CONCAT(SUBSTR(FECHA_ENTREGAPLANIFICADA, 0, 4), SUBSTR(FECHA_ENTREGAPLANIFICADA, 6, 2)) AS aniomes,
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
UM_PEDIDO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,
MON_LOC,
MON_PED,
MON_USD,
MON_EUR,
SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA,

0 AS IND_CANT_EM_PEDIDO_ENTIEMPO,
IFF((DATEDIFF(DAY, FECHA_CONTABILIZACION, FECHA_ENTREGAOBJETIVO) >= 0), IND_CANTIDAD_UM_PED, 0) AS IND_CANT_EM_COMPLETAS_ENTIEMPO
FROM PRE.PFCT_LOG_ABASTECIMIENTOS
WHERE 
    DOCCOMPRAS_CLASE IN (''LP'',''NB'',''ZDNP'',''ZFIN'',''ZINV'',''ZIPT'',''ZNB'',''ZNBS'',''ZURG'')
    AND CLAVEOPERACION IN (''002'', ''006'', ''012'')
    AND SUBSTRING(ALMACENCENTRO_ID, 1, POSITION(''_'' IN ALMACENCENTRO_ID) - 1) IN ('''','' '',''ME01'',''MP01'',''MP02'',''RF01'',''RF02'')
    AND IND_CANTIDAD_UM_PED <> 0)

JOIN RAW.PARAMETROS_EXTRACCION
ON EXTRACTOR = ''2LIS_02_SCL''
AND NEGOCIO = ''ADHMEXICO''
AND PARAMETRO = ''ORGCOMPRAS_ID''
AND ORGCOMPRAS_ID BETWEEN R_INICIO AND R_FIN

WHERE DOCCOMPRAS IN (SELECT DISTINCT EBELN FROM RAW.SQ1_EXT_2LIS_02_SCL
WHERE FECHA_CARGA = (SELECT MAX(FECHA_CARGA) ------------ULTIMOS REGISTROS--------
                       FROM RAW.SQ1_EXT_2LIS_02_SCL)
        AND TIPO = ''DELTA''
)

GROUP BY 
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,
UM_PEDIDO,
MON_PED,
MON_LOC,
MON_USD,
MON_EUR,
CLAVEMP_LOC,
CLAVEMP_USD,
CLAVEMP_EUR,
SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA

HAVING SUM(IND_CANT_EM_PEDIDO_ENTIEMPO) <> 0

----------------------------------------Fin Fecha Entrega --------------------------------------------
UNION ALL
---------------------------------------- Fecha Contable --------------------------------------------

SELECT
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,

0 AS IND_CANT_EM_TOTAL,
UM_PEDIDO,

0 AS IND_IMPTE_COMPRA_PED,
0 AS IND_IMPTE_FLETE_PED,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_PED,
MON_PED,

0 AS IND_IMPTE_COMPRA_LOC,
0 AS IND_IMPTE_FLETE_LOC,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_LOC ,
MON_LOC,

0 AS IND_IMPTE_COMPRA_USD,
0 AS IND_IMPTE_FLETE_USD,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_USD,
MON_USD,

0 AS IND_IMPTE_COMPRA_EUR,
0 AS IND_IMPTE_FLETE_EUR,
0 AS IND_IMPTE_COMPRA_SIN_FLETE_EUR,
MON_EUR,

0 AS TIPOCAMBIO_USD,
0 AS TIPOCAMBIO_EUR,

0 AS IND_CANT_DIAS_COLOCACION ,
0 AS IND_CANT_POSICIONES_PEDIDO,

0 AS IND_CANT_EM_PEDIDO_ENTIEMPO, 
0 AS IND_CANT_EM_COMPLETAS_ENTIEMPO, 
0 AS IND_CANT_POS_COMPLETAS_ENTIEMPO,
0 AS IND_CANT_POS_NOCOMPLETAS_ENTIEMPO,

SUM(IFF((DATEDIFF(day, fecha_contabilizacion, FECHA_ENTREGAOBJETIVO) < 0), IND_CANTIDAD_UM_PED, 0)) AS IND_CANT_EM_TOTAL_VENCIDAS,
SUM(DATEDIFF(day, fecha_reparto, fecha_contabilizacion) * IND_CANTIDAD_UM_PED) AS IND_CANT_DIASPONDERADOS,
SUM(IFF((DATEDIFF(day, fecha_contabilizacion, FECHA_ENTREGAOBJETIVO) < 0),
    IFF(DATEDIFF(day, FECHA_ENTREGAOBJETIVO, fecha_contabilizacion) = 0,
        DATEDIFF(day, FECHA_ENTREGAOBJETIVO, fecha_contabilizacion),
        (DATEDIFF(day, FECHA_ENTREGAOBJETIVO, fecha_contabilizacion) * IND_CANTIDAD_UM_PED)
    ), 0
)) AS IND_CANT_DIASPODERADOS_ANT,
    COUNT(DISTINCT CONCAT(DOCCOMPRAS, ''_'', DOCCOMPRAS_POS, ''_'', DOCCOMPRAS_REPARTO)) AS IND_CANT_POS_TOTAL,

CONCAT(MON_PED,''_'',MON_LOC) AS CLAVEMP_LOC,
CONCAT(MON_PED,''_USD'') AS CLAVEMP_USD,
CONCAT(MON_PED,''_EUR'') AS CLAVEMP_EUR,

SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA

FROM PRE.PFCT_LOG_ABASTECIMIENTOS
JOIN RAW.PARAMETROS_EXTRACCION
ON EXTRACTOR = ''2LIS_02_SCL''
AND NEGOCIO = ''ADHMEXICO''
AND PARAMETRO = ''ORGCOMPRAS_ID''
AND ORGCOMPRAS_ID BETWEEN R_INICIO AND R_FIN

WHERE DOCCOMPRAS_CLASE IN (''LP'', ''NB'', ''ZDNP'', ''ZFIN'', ''ZINV'', ''ZIPT'', ''ZNB'', ''ZNBS'', ''ZURG'')
  AND CLAVEOPERACION IN (''002'', ''006'', ''012'')
  AND SUBSTRING(ALMACENCENTRO_ID, 1, POSITION(''_'' IN ALMACENCENTRO_ID) - 1) IN (''ME01'', ''MP01'', ''MP02'', ''RF01'', ''RF02'')

AND DOCCOMPRAS IN (SELECT DISTINCT EBELN FROM RAW.SQ1_EXT_2LIS_02_SCL
WHERE FECHA_CARGA = (SELECT MAX(FECHA_CARGA) ------------ULTIMOS REGISTROS--------
                       FROM RAW.SQ1_EXT_2LIS_02_SCL)
        AND TIPO = ''DELTA''
)

GROUP BY  
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,
UM_PEDIDO,
MON_PED,
MON_LOC,
MON_USD,
MON_EUR,
CLAVEMP_LOC,
CLAVEMP_USD,
CLAVEMP_EUR,
SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA
----------------------------------------Fin Fecha Contable --------------------------------------------
---------------------------------------- FIN NIVEL DE SERVICIOS--------------------------------------------------

UNION ALL

-----------------------------------BASE Y DIAS ------------------------------------------
SELECT
CENTRO_ID,
ALMACENCENTRO_ID,
ORGCOMPRAS_ID,
GRUPOCOMPRAS_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
GRUPOARTICULOS_ID,
PROVEEDOR_ID,
DOCCOMPRAS_CLASE,
DOCCOMPRAS_TIPO,
DOCCOMPRAS,
DOCCOMPRAS_POS,
DOCCOMPRAS_REPARTO,
FECHA_LIBERACION,
FECHA_DOCCOMPRAS,
FECHA_ENTREGAPLANIFICADA,
FECHA_ENTREGAOBJETIVO,
FECHA_CONTABILIZACION,
CLAVEOPERACION,
SOLPED,
SOLPED_POS,

IND_CANT_EM_TOTAL,
UM_PEDIDO,

IND_IMPTE_COMPRA_PED,
IND_IMPTE_FLETE_PED,
IND_IMPTE_COMPRA_SIN_FLETE_PED,
MON_PED,

IND_IMPTE_COMPRA_LOC,
IND_IMPTE_FLETE_LOC,
IND_IMPTE_COMPRA_SIN_FLETE_LOC ,
MON_LOC,

IND_IMPTE_COMPRA_USD,
IND_IMPTE_FLETE_USD,
IND_IMPTE_COMPRA_SIN_FLETE_USD,
MON_USD,

IND_IMPTE_COMPRA_EUR,
IND_IMPTE_FLETE_EUR,
IND_IMPTE_COMPRA_SIN_FLETE_EUR,
MON_EUR,

TIPOCAMBIO_USD,
TIPOCAMBIO_EUR,

IND_CANT_DIAS_COLOCACION,
IND_CANT_POSICIONES_PEDIDO,

0 AS IND_CANT_EM_PEDIDO_ENTIEMPO, 
0 AS IND_CANT_EM_COMPLETAS_ENTIEMPO, 
0 AS IND_CANT_POS_COMPLETAS_ENTIEMPO,
0 AS IND_CANT_POS_NOCOMPLETAS_ENTIEMPO,

0 AS IND_CANT_EM_TOTAL_VENCIDAS,
0 AS IND_CANT_DIASPONDERADOS,
0 AS IND_CANT_DIASPODERADOS_ANT,
0 AS IND_CANT_POS_TOTAL,

CLAVEMP_LOC,
CLAVEMP_USD,
CLAVEMP_EUR,

SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA

FROM PRE.PFCT_LOG_ABASTECIMIENTOS

JOIN RAW.PARAMETROS_EXTRACCION
ON EXTRACTOR = ''2LIS_02_SCL''
AND NEGOCIO = ''ADHMEXICO''
AND PARAMETRO = ''ORGCOMPRAS_ID''
AND ORGCOMPRAS_ID BETWEEN R_INICIO AND R_FIN

WHERE DOCCOMPRAS IN (SELECT DISTINCT EBELN FROM RAW.SQ1_EXT_2LIS_02_SCL
WHERE FECHA_CARGA = (SELECT MAX(FECHA_CARGA) ------------ULTIMOS REGISTROS--------
                       FROM RAW.SQ1_EXT_2LIS_02_SCL)
        AND TIPO = ''DELTA''
)
;

	-------------------------------------------------
        -------------------------------------------------

        RETURN (''Complete'');
        
    ---- MANEJO DE EXCEPCIONES POR ERRORES
    EXCEPTION
    
        when statement_error then 
        
        SELECT CONCAT(''Failed: Code: '',:sqlcode,
                    ''\\\\n  Message: '',:sqlerrm,
                    ''\\\\n  State: '',:sqlstate) INTO :D_MENSAJE;
        
        //Registro bitacora       
        --CALL PRE_PRD_SAP.LOGS.SP_LOG_PRD (:ID, :D_PROCESO, ''FCT_LOG_ADH_ABASTECIMIENTOS'', ''FALLIDO'',''INSERT'',:SQLROWCOUNT, :NM_TIPO_LOG, :F_INICIO, :F_FIN,  :T_EJECUCION, :D_MENSAJE);

        RETURN (:D_MENSAJE);

END;
END';