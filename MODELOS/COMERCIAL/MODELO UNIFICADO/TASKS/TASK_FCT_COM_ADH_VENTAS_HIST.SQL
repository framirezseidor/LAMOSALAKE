create or replace task MIRRORING.TASK_FCT_COM_ADH_VENTAS_HIST
	warehouse=LAMOSALAKE_DEV_WH
	when SYSTEM$STREAM_HAS_DATA('STREAM_FCT_COM_ADH_VENTAS_HIST')
	as begin

    TRUNCATE TABLE TR_FCT_COM_ADH_VENTAS_HIST;

    INSERT INTO TR_FCT_COM_ADH_VENTAS_HIST
    SELECT * FROM STREAM_FCT_COM_ADH_VENTAS_HIST ;
    
  --RECREAR STREAM para eliminar basura
 -- create or replace stream MIRRORING.STREAM_FCT_COM_ADH_COMERCIAL on table MIRRORING.FCT_COM_ADH_COMERCIAL;

    -- 1. BORRAR registros eliminados
  DELETE FROM MIRRORING.FCT_COM_ADH_COMERCIAL WHERE SISORIGEN_ID = 'BW4' AND MODELO = 'VENTAS' ;

    -- 2. INSERTAR o ACTUALIZAR registros nuevos o modificados
  INSERT INTO MIRRORING.FCT_COM_ADH_COMERCIAL
  SELECT * FROM MIRRORING.VW_FCT_COM_ADH_VENTAS_HIST;

END;


ALTER TASK MIRRORING.TASK_FCT_COM_ADH_VENTAS_HIST RESUME;


