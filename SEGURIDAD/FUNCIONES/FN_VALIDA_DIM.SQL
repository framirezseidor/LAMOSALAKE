CREATE OR REPLACE FUNCTION SEGURIDAD.FN_VALIDA_DIM("NOMBRE_DIM" VARCHAR(50),"VALOR_DIM" VARCHAR(50))
RETURNS BOOLEAN
LANGUAGE SQL
AS 
$$
    select 
        exists( SELECT 1 
        FROM 
            SEGURIDAD.VW_SEG_VISTA_GRAL 
        WHERE 
            USUARIO = CURRENT_USER 
            AND (DIM_ROL = NOMBRE_DIM  AND COALESCE(ROLE_USUARIO,'')='')
            AND (VALOR_ROL = VALOR_DIM OR VALOR_ROL = 'ALL')
            ) 
            AND
        exists( SELECT 1 
        FROM 
            SEGURIDAD.VW_SEG_VISTA_GRAL 
        WHERE 
            USUARIO = CURRENT_USER 
            AND ( (DIM_ROL = NOMBRE_DIM  AND COALESCE(ROLE_USUARIO,'')<>'')
            AND (VALOR_ROL = VALOR_DIM OR VALOR_ROL = 'ALL') )
            OR  (DIM_ROL = NOMBRE_DIM  AND COALESCE(ROLE_USUARIO,'')='SAP_ROLE')
            ) 
$$
;


SELECT EXISTS(
SELECT 1
        FROM 
            SEGURIDAD.VW_SEG_VISTA_GRAL 
        WHERE 
            USUARIO = 'FIDEL_RAMIREZ' 
            AND ( (DIM_ROL = 'CANALDISTRIB_ID'  AND COALESCE(ROLE_USUARIO,'')<>'')
            AND (VALOR_ROL = 'R108' OR VALOR_ROL = 'ALL') )
            OR  (DIM_ROL = 'CANALDISTRIB_ID'  AND COALESCE(ROLE_USUARIO,'')='SAP_ROLE'));