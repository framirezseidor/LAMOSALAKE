USE DATABASE LAMOSALAKE_DEV;
USE SCHEMA CON;
CREATE OR REPLACE VIEW  VW_FCT_LOG_ADH_INVENTARIO_PT AS

SELECT
ANIO,
MES,
ANIOMES,
FECHA_FOTO_INVENTARIO,
CENTRO_ID,
ALMACEN_ID,
ALMACENCENTRO_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
TIPOMATERIAL_ID,
CONTROL_PRECIOS,
STOCKESPECIAL,
NUMSTOCKESPECIAL,
LOTE,
LOTECENTRO_ID,
IND_LIBRE_UTILIZACION_TON,
IND_BLOQUEADO_TON,
IND_CONTROL_CALIDAD_TON,
IND_TRANSITO_TON,
IND_INVENTARIO_FISICO_TON,
IND_LIBRE_VENTA_TON,
IND_STOCK_SEGURIDAD_TON,
UNI_EST,
IND_COSTO_INV_MXN,
MON_MXN,
IND_COSTO_INV_LOC,
MON_LOC,
IND_COSTO_INV_USD,
MON_USD,
SISORIGEN_ID,
MANDANTE,
FECHA_CARGA,
ZONA_HORARIA

FROM FCT_LOG_ADH_INVENTARIO_ACT WHERE TIPOMATERIAL_ID IN ('FERT', 'ZHAW')

UNION

SELECT
ANIO,
MES,
ANIOMES,
FECHA_FOTO_INVENTARIO,
CENTRO_ID,
ALMACEN_ID,
ALMACENCENTRO_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
TIPOMATERIAL_ID,
CONTROL_PRECIOS,
STOCKESPECIAL,
NUMSTOCKESPECIAL,
LOTE,
LOTECENTRO_ID,
SUM(IND_LIBRE_UTILIZACION_TON),
SUM(IND_BLOQUEADO_TON),
SUM(IND_CONTROL_CALIDAD_TON),
SUM(IND_TRANSITO_TON),
SUM(IND_INVENTARIO_FISICO_TON),
SUM(IND_LIBRE_VENTA_TON),
SUM(IND_STOCK_SEGURIDAD_TON),
MAX(UNI_EST),
SUM(IND_COSTO_INV_MXN),
MAX(MON_MXN),
SUM(IND_COSTO_INV_LOC),
MAX(MON_LOC),
SUM(IND_COSTO_INV_USD),
MAX(MON_USD),
'', --SISORIGEN_ID
'', --MANDANTE
'', --FECHA_CARGA
'' --ZONA_HORARIA

FROM
(
SELECT
ANIO,
MES,
ANIOMES,
FECHA_FOTO_INVENTARIO,
CENTRO_ID,
ALMACEN_ID,
ALMACENCENTRO_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
TIPOMATERIAL_ID,
CONTROL_PRECIOS,
STOCKESPECIAL,
NUMSTOCKESPECIAL,
LOTE,
LOTECENTRO_ID,
IND_LIBRE_UTILIZACION_TON,
IND_BLOQUEADO_TON,
IND_CONTROL_CALIDAD_TON,
IND_TRANSITO_TON,
IND_INVENTARIO_FISICO_TON,
0 AS IND_LIBRE_VENTA_TON,
IND_STOCK_SEGURIDAD_TON,
UNI_EST,
IND_COSTO_INV_MXN,
MON_MXN,
IND_COSTO_INV_LOC,
MON_LOC,
IND_COSTO_INV_USD,
MON_USD

FROM FCT_LOG_ADH_INVENTARIO_FOTO WHERE TIPOMATERIAL_ID IN ('FERT', 'ZHAW')


UNION

SELECT
ANIO,
MES,
ANIOMES,
FECHA_FOTO_INVENTARIO,
CENTRO_ID,
ALMACEN_ID,
ALMACENCENTRO_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
TIPOMATERIAL_ID,
CONTROL_PRECIOS,
STOCKESPECIAL,
NUMSTOCKESPECIAL,
LOTE,
LOTECENTRO_ID,
0,--IND_LIBRE_UTILIZACION_TON,
0,--IND_BLOQUEADO_TON,
0,--IND_CONTROL_CALIDAD_TON,
0,--IND_TRANSITO_TON,
0,--IND_INVENTARIO_FISICO_TON,
IND_LIBRE_VENTA_TON,
0,--IND_STOCK_SEGURIDAD_TON,
UNI_EST,
0,--IND_COSTO_INV_MXN,
'',--MON_MXN,
0,--IND_COSTO_INV_LOC,
'',--MON_LOC,
0,--IND_COSTO_INV_USD,
''--MON_USD

FROM FCT_LOG_ADH_INV_LIBREVTA_FOTO WHERE TIPOMATERIAL_ID IN ('FERT', 'ZHAW')
)
GROUP BY 
ANIO,
MES,
ANIOMES,
FECHA_FOTO_INVENTARIO,
CENTRO_ID,
ALMACEN_ID,
ALMACENCENTRO_ID,
MATERIAL_ID,
MATERIALCENTRO_ID,
TIPOMATERIAL_ID,
CONTROL_PRECIOS,
STOCKESPECIAL,
NUMSTOCKESPECIAL,
LOTE,
LOTECENTRO_ID