CREATE OR ALTER TABLE mirroring.DIM_CAL_ADH_RENTABILIDAD AS
WITH CTE_FECHAS AS (
  SELECT DATEADD(DAY, SEQ4(), '1990-01-01') AS FECHA
  FROM TABLE(GENERATOR(ROWCOUNT => 22280))
)
SELECT
  -- Fecha sin hora
  CAST(FECHA AS DATE) AS FECHA,

  -- Año, Mes, Día
  YEAR(FECHA) AS ANIO,
  MONTH(FECHA) AS MES,
  DAY(FECHA) AS DIA,

  -- AÑO + MES en formato YYYYMM
  TO_CHAR(FECHA, 'YYYY-MM') AS ANIOMES,

  -- Día de la semana reducido a 3 letras en español
  CASE DAYOFWEEK(FECHA)
    WHEN 1 THEN 'Dom'
    WHEN 2 THEN 'Lun'
    WHEN 3 THEN 'Mar'
    WHEN 4 THEN 'Mié'
    WHEN 5 THEN 'Jue'
    WHEN 6 THEN 'Vie'
    WHEN 7 THEN 'Sáb'
  END AS DIA_NOMBRE,

  -- Nombre del mes reducido a 3 letras en español
  CASE MONTH(FECHA)
    WHEN 1 THEN 'Ene' WHEN 2 THEN 'Feb' WHEN 3 THEN 'Mar' WHEN 4 THEN 'Abr'
    WHEN 5 THEN 'May' WHEN 6 THEN 'Jun' WHEN 7 THEN 'Jul' WHEN 8 THEN 'Ago'
    WHEN 9 THEN 'Sep' WHEN 10 THEN 'Oct' WHEN 11 THEN 'Nov' WHEN 12 THEN 'Dic'
  END AS MES_NOMBRE,

  -- Trimestre (1-4)
  'Q' || QUARTER(FECHA) AS TRIMESTRE,

  -- Número de semana del año
  WEEKOFYEAR(FECHA) AS SEMANA_NUMERO,

  -- Fecha en texto: DD Mes Abrev Año
  TO_CHAR(DAY(FECHA), '00') || ' ' || 
  CASE MONTH(FECHA)
    WHEN 1 THEN 'Ene' WHEN 2 THEN 'Feb' WHEN 3 THEN 'Mar' WHEN 4 THEN 'Abr'
    WHEN 5 THEN 'May' WHEN 6 THEN 'Jun' WHEN 7 THEN 'Jul' WHEN 8 THEN 'Ago'
    WHEN 9 THEN 'Sep' WHEN 10 THEN 'Oct' WHEN 11 THEN 'Nov' WHEN 12 THEN 'Dic'
  END || ' ' || TO_CHAR(YEAR(FECHA)) AS FECHA_TEXTO

FROM CTE_FECHAS;

create or replace stream MIRRORING.STREAM_DIM_CAL_ADH_RENTABILIDAD on table MIRRORING.DIM_CAL_ADH_RENTABILIDAD;
